---
title: "第二次作业"
author: "wzx"
date: "2023-03-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
summary(cars)
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.

##将数据导入
```{r}
library(ggplot2)
library(readxl)
d_1<-read_excel("第二次作业数据.xlsx",sheet=1)
d_2<-read_excel("第二次作业数据.xlsx",sheet=2)
d_3<-read_excel("第二次作业数据.xlsx",sheet=3)
d_4<-read_excel("第二次作业数据.xlsx",sheet=4)
d_5<-read_excel("第二次作业数据.xlsx",sheet=5)
d_6<-read_excel("第二次作业数据.xlsx",sheet=6)
```

##分别对6页数据拟合
```{r}
fit_x <- seq(0, 40, length.out=100) #⽣成100个x，涵盖原始数据范围
fit_1<-nls(AGC~121 * (1 - exp(-k * t))^ c, data=d_1, start=list(k =0.009, c= 0.1495 ) )
summary(fit_1)
names(summary(fit_1))
summary(fit_1)$coefficients

k_1<- summary(fit_1)$coefficients[1]
c_1<- summary(fit_1)$coefficients[2]
fit_y <- 121 * (1 - exp(- k_1 * fit_x))^ c_1 #将x和参数值代⼊⽶⽒⽅程，计算y
d_fit1 <- data.frame(t=fit_x, AGC=fit_y,Year="Recovering degraded forest") 



fit_2<-nls(AGC~121 * (1 - exp(-k * t))^ c, data=d_2, start=list(k =0.009, c= 0.1495 ) )
summary(fit_2)
names(summary(fit_2))
summary(fit_2)$coefficients

k_2<- summary(fit_2)$coefficients[1]
c_2<- summary(fit_2)$coefficients[2]
fit_y <- 121 * (1 - exp(-k_2 * fit_x))^ c_2 
d_fit2 <- data.frame(t=fit_x, AGC=fit_y,Year="Recovering degraded forest") 


fit_3<-nls(AGC~121 * (1 - exp(-k * t))^ c, data=d_3, start=list(k =0.009, c= 0.1495 ) )
summary(fit_3)
names(summary(fit_3))
summary(fit_3)$coefficients

k_3<- summary(fit_3)$coefficients[1]
c_3<- summary(fit_3)$coefficients[2]
fit_y <- 121 * (1 - exp(-k_3 * fit_x))^ c_3 
d_fit3 <- data.frame(t=fit_x, AGC=fit_y,Year="Recovering degraded forest") 

fit_4<-nls(AGC~121 * (1 - exp(-k * t))^ c, data=d_4, start=list(k =0.009, c= 0.1495 ) )
summary(fit_4)
names(summary(fit_4))
summary(fit_4)$coefficients

k_4<- summary(fit_4)$coefficients[1]
c_4<- summary(fit_4)$coefficients[2]
fit_y <- 121 * (1 - exp(-k_4 * fit_x))^ c_4 
d_fit4 <- data.frame(t=fit_x, AGC=fit_y,Year="Recovering secondary forest")



fit_5<-nls(AGC~121 * (1 - exp(-k * t))^ c, data=d_5, start=list(k =0.009, c= 0.1495 ) )
summary(fit_5)
names(summary(fit_5))
summary(fit_5)$coefficients

k_5<- summary(fit_5)$coefficients[1]
c_5<- summary(fit_5)$coefficients[2]
fit_y <- 121 * (1 - exp(-k_5 *fit_x))^ c_5 
d_fit5 <- data.frame(t=fit_x, AGC=fit_y,Year="Recovering secondary forest")


fit_6<-nls(AGC~121 * (1 - exp(-k * t))^ c, data=d_6, start=list(k =0.009, c= 0.1495 ) )
summary(fit_6)
names(summary(fit_6))
summary(fit_6)$coefficients

k_6<- summary(fit_6)$coefficients[1]
c_6<- summary(fit_6)$coefficients[2]
fit_y <- 121 * (1 - exp(-k_6 *fit_x))^ c_6 
d_fit6 <- data.frame(t=fit_x, AGC=fit_y,Year="Recovering secondary forest") 

```
##绘图
```{r}
ggplot()+
  geom_line(data = d_fit1,aes(x =t,y =AGC,colour = "Amazon"),linewidth=1)+#绘线
  geom_point(data = d_1,aes(x =t,y =AGC,colour = "Amazon"),size=2)+#绘点
  geom_line(data = d_fit2,aes(x =t,y =AGC,colour ="Borneo"),linewidth=1) + #同上重复3次
  geom_point(data = d_2,aes(x =t,y =AGC,colour = "Borneo"),size=2)+
  geom_line(data = d_fit3,aes(x =t,y =AGC,colour ="Central Africa"),linewidth=1) + 
  geom_point(data = d_3,aes(x =t,y =AGC,colour = "Central Africa"),size=2)+
  scale_colour_manual("",values = c("Amazon" = "#9AC9DB","Borneo" = "#96C37D","Central Africa" = "#a09d9c"))+
  xlab("Years since last disturbance event")+ylab("AGC"~"(Mg"~"C"~"ha"^"–1"~")")+#图片颜色、字体
  geom_line(data = d_fit4,aes(x =t,y =AGC,colour = "Amazon"),linewidth=1)+#同上重复后三条线
  geom_point(data = d_4,aes(x =t,y =AGC,colour = "Amazon"),size=2)+
  geom_line(data = d_fit5,aes(x =t,y =AGC,colour ="Borneo"),linewidth=1) + 
  geom_point(data = d_5,aes(x =t,y =AGC,colour = "Borneo"),size=2)+
  geom_line(data = d_fit6,aes(x =t,y =AGC,colour ="Central Africa"),linewidth=1) + 
  geom_point(data = d_6,aes(x =t,y =AGC,colour = "Central Africa"),size=2)+
  scale_colour_manual("",values = c("Amazon" = "#9AC9DB","Borneo" = "#96C37D","Central Africa" = "#a09d9c"))+
  xlab("Years since last disturbance event")+ylab("AGC"~"(Mg"~"C"~"ha"^"–1"~")")+#图片颜色及总体
  theme_classic()+#主题
  geom_point(data = data.frame(x = 50, y = 121.0104, sd = 10),
           aes(x , y), color="#9AC9DB",shape=4) + #额外添加点 
  geom_errorbar(data = data.frame(x = 50, y =121.0104, sd = 10),
                aes(x , y, ymin= y -sd, ymax = y+sd), width = 0.2,
                color="#9AC9DB") + 
  geom_point(data = data.frame(x = 52, y = 121.1739, sd = 10),
             aes(x , y), color="#96C37D",shape=4) +
  geom_errorbar(data = data.frame(x = 52, y =121.1739, sd = 10),
                aes(x , y, ymin= y -sd, ymax = y+sd), width = 0.2,
                color="#96C37D") +   
  geom_point(data = data.frame(x = 48, y = 116.6176, sd = 10),
                                                aes(x , y), color="#a09d9c",
             shape=4) + 
  geom_errorbar(data = data.frame(x = 48, y = 116.6176, sd = 10),
                aes(x , y, ymin= y -sd, ymax = y+sd), width = 0.2,
                color="#a09d9c") + 
  scale_x_continuous(breaks = c(0,10, 20, 30, 40, 50),#坐标轴设置
                     labels = c("0", "10", "20", "30", "40","OG"))+
  scale_y_continuous(breaks = c(0,20, 40, 60, 80, 100,120,140),
                     labels = c("0", "20", "40", "60", "80","100","120","140"))+
  facet_wrap(~Year, scales = "fixed")#分页设置
```

